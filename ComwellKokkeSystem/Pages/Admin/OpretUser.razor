@page "/opretuser"
@inject IAuthService AuthService
@inject NavigationManager NavManager
@using Modeller

<div class="d-flex justify-content-center align-items-center" style="min-height: 100vh; background-color: #f5f5f5;">
    <div class="p-5 shadow" style="background-color: white; border-radius: 20px; width: 100%; max-width: 600px;">
        <h2 class="text-center mb-4" style="color: #003b4a;">Opret ny bruger</h2>

        <EditForm Model="@newUser" OnValidSubmit="HandleRegister">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="form-group mb-3">
                <label>Brugernavn</label>
                <InputText class="form-control rounded-pill" @bind-Value="newUser.Username" />
            </div>

            <div class="form-group mb-3">
                <label>Adgangskode</label>
                <InputText type="password" class="form-control rounded-pill" @bind-Value="newUser.Password" />
            </div>

            <div class="form-group mb-3">
                <label>Navn</label>
                <InputText class="form-control rounded-pill" @bind-Value="newUser.Navn" />
            </div>

            <div class="form-group mb-3">
                <label>Email</label>
                <InputText class="form-control rounded-pill" @bind-Value="newUser.Email" />
            </div>

            <div class="form-group mb-3">
                <label>Telefonnummer</label>
                <InputText class="form-control rounded-pill" @bind-Value="newUser.Tlf" />
            </div>

            <div class="form-group mb-3">
                <label>Adresse</label>
                <InputText class="form-control rounded-pill" @bind-Value="newUser.Adresse" />
            </div>

            <div class="form-group mb-3">
                <label>Startdato</label>
                <InputDate class="form-control rounded-pill" @bind-Value="newUser.StartDato" />
            </div>

            <div class="form-group mb-3">
                <label>Slutdato (valgfri)</label>
                <InputDate class="form-control rounded-pill" @bind-Value="newUser.SlutDato" />
            </div>

            <div class="form-group mb-3">
                <label>Hotel</label>
               <select class="form-control rounded-pill" @onchange="OnHotelChanged">
                <option value="0">Vælg hotel</option>
                <option value="1">Kongeborgh</option>
                <option value="2">Holte</option>
                </select>
            </div>

            <div class="form-group mb-4">
                <label>Rolle</label>
                <InputSelect class="form-control rounded-pill" @bind-Value="newUser.Role">
                    <option value="elev">Elev</option>
                    <option value="kok">Kok</option>
                    <option value="HR">HR</option>
                    <option value="admin">Admin</option>
                </InputSelect>
            </div>

            <button type="submit" class="btn btn-primary w-100">Opret Bruger</button>
        </EditForm>

        @if (!string.IsNullOrEmpty(message))
        {
            <div class="alert @(registerSuccess ? "alert-success" : "alert-danger") mt-3">
                @message
            </div>
        }
    </div>
</div>

@code {
    private UserModel newUser = new()
        {
            StartDato = DateTime.Today,
            SlutDato = null
        };

    private string message = "";
    private bool registerSuccess = false;

    private async Task HandleRegister()
    {
        var success = await AuthService.Register(newUser);

        registerSuccess = success;

        if (success)
        {
            message = "Bruger oprettet!";
            await Task.Delay(1500);
            NavManager.NavigateTo("/administrator");
        }
        else
        {
            message = "Noget gik galt – brugeren blev ikke oprettet.";
        }
    }
    private void OnHotelChanged(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out int id))
        {
            newUser.HotelId = id;

            newUser.HotelNavn = id switch
            {
                1 => "Kongeborgh",
                2 => "Holte",
                _ => null
            };
        }
    }
}
