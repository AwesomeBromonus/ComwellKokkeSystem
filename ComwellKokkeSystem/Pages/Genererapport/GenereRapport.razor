@page "/genererapport"
@using Modeller

<PageTitle>Generer Rapport</PageTitle>

<h3>Generer HR Rapport</h3>

<div class="row mb-3">
    <div class="col-md-3">
        <label for="yearSelect" class="form-label">Vælg år:</label>
        <select id="yearSelect" class="form-select" @bind="selectedYear">
            @foreach (var year in Enumerable.Range(DateTime.Now.Year - 5, 10).OrderByDescending(y => y))
            {
                <option value="@year">@year</option>
            }
        </select>
    </div>
    <div class="col-md-9 d-flex align-items-end">
        <button class="btn btn-primary me-2" @onclick="LoadReportData">Indlæs Rapport</button>
        <button class="btn btn-success" @onclick="ExportToExcel">Eksporter til Excel</button>
    </div>
</div>

@if (isLoading)
{
    <p><em>Indlæser rapportdata...</em></p>
}
else if (reportData.Any())
{
    <p>Viste resultater: @reportData.Count</p>
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="thead-dark">
            <tr>
                <th>Elev Navn</th>
                <th>Hotel</th>
                <th>Rolle</th>
                <th>Praktikperiode</th>
                <th>Delmål Beskrivelse</th>
                <th>Ansvarlig</th>
                <th>Status</th>
                <th>Fremgang</th>
                <th>Deadline</th>
            </tr>
            </thead>
            <tbody>
            @foreach (var item in reportData)
            {
                <tr>
                    <td>@item.ElevNavn</td>
                    <td>@item.HotelNavn</td>
                    <td>@item.Rolle</td>
                    <td>@item.PraktikperiodeNavn</td>
                    <td>@item.DelmålBeskrivelse</td>
                    <td>@item.DelmålAnsvarlig</td>
                    <td>@item.DelmålCalculatedStatus</td>
                    <td>@item.DelmålProgressText</td>
                    <td>@item.DelmålDeadline.ToShortDateString()</td>
                </tr>
            }
            </tbody>
        </table>
    </div>
}
else
{
    <p>Ingen rapportdata fundet for det valgte år.</p>
}