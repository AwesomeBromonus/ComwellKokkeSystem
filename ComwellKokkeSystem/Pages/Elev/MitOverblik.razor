@page "/mitoverblik"
@inject NavigationManager NavManager
@inject IUserStateService UserStateService
@inject IElevplanService ElevplanService
@using ComwellKokkeSystem.Service
@using Modeller

<link href="css/Panel.css" rel="stylesheet" />

<div class="admin-container">
    <!-- Header med brugervelkomst -->
    <div class="admin-header">
        <h2>🎓 Mit Elev Overblik</h2>
        <p>Velkommen til Comwells elevsystem, <span class="username">@UserStateService.CurrentUser?.Navn</span>!</p>
    </div>

    <!-- Dashboard kort -->
    <div class="dashboard-cards">
        <!-- Elevplan kort -->
        <div class="dashboard-card" @onclick="@(() => GoToSubGoals(currentElevplan?.Id ?? 0))">
            <div class="icon">📋</div>
            <h4>Din Elevplan</h4>
            @if (currentElevplan != null)
            {
                <p>@currentElevplan.StartDato.ToShortDateString() - @currentElevplan.SlutDato.ToShortDateString()</p>
            }
            else
            {
                <p>Ingen aktiv plan</p>
            }
        </div>

        <!-- XP kort -->
        <div class="dashboard-card highlight" @onclick="GoToLevelUp">
            <div class="icon">🔥</div>
            <h4>Point & Niveau</h4>
            <p><strong>483 XP</strong> (Mål: 1000 XP)</p>
            <div class="progress-bar">
                <div class="progress" style="width: 48%"></div>
            </div>
            <p>Nuværende: <strong>Tomat 🍳</strong></p>
        </div>

        <!-- Læring kort -->
        <div class="dashboard-card" @onclick="GoToLearning">
            <div class="icon">📚</div>
            <h4>Læring</h4>
            <p>Udforsk materialer og forbedr dine færdigheder</p>
        </div>

        <!-- Quiz kort -->
        <div class="dashboard-card" @onclick="GoToQuiz">
            <div class="icon">❓</div>
            <h4>Quizzer</h4>
            <p>Test din viden med sjove quizzes</p>
        </div>
    </div>

    <!-- Elevplan detaljer -->
    @if (currentElevplan != null)
    {
        <div class="detail-section">
            <h3>📝 Elevplan detaljer</h3>
            <div class="detail-grid">
                <div>
                    <label>Startdato:</label>
                    <p>@currentElevplan.StartDato.ToShortDateString()</p>
                </div>
                <div>
                    <label>Slutdato:</label>
                    <p>@currentElevplan.SlutDato.ToShortDateString()</p>
                </div>
                <div class="full-width">
                    <label>Kommentar:</label>
                    <p>@currentElevplan.Kommentar</p>
                </div>
            </div>
        </div>
    }
</div>

@code {
    private Modeller.Elevplan? currentElevplan;
    
    protected override async Task OnInitializedAsync()
    {
        if (UserStateService.IsLoggedIn && UserStateService.CurrentUser?.Id != null)
        {
            var plans = await ElevplanService.GetElevplanerForElevAsync(UserStateService.CurrentUser.Id);
            currentElevplan = plans?.FirstOrDefault();
        }
    }

    private void GoToSubGoals(int elevplanId) => NavManager.NavigateTo($"/delmaal/{elevplanId}");
    private void GoToLevelUp() => NavManager.NavigateTo("/niveauopgradering");
    private void GoToLearning() => NavManager.NavigateTo("/laering");
    private void GoToQuiz() => NavManager.NavigateTo("/quizlist");
}