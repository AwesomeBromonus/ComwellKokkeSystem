@page "/mitoverblik"
@inject NavigationManager NavManager
@inject UserState UserState
@using ComwellKokkeSystem.Service
@inject IElevplanService ElevplanService

<h3 class="mb-4">🎓 Mit Elev Overblik</h3>

@if (!UserState.IsLoggedInChecked)
{
    <p>⏳ Indlæser brugerstatus...</p>
}
else if (!UserState.IsLoggedIn)
{
    <div class="alert alert-warning">🔒 Du skal være logget ind for at se denne side.</div>
}
else if (!UserState.IsElevAdgang)
{
    <div class="alert alert-danger">🚫 Adgang nægtet – kun elever og kokke har adgang til denne side.</div>
}
else
{
    <div class="card shadow-sm border-0 mb-4 bg-light p-4 rounded-4">
        <h5 class="fw-bold">Velkommen til Comwells elevsystem, @UserState.Username!</h5>
    </div>

    @if (elevplanLoading)
    {
        <p>⏳ Indlæser elevplan...</p>
    }
    else if (!string.IsNullOrWhiteSpace(fejlbesked))
    {
        <div class="alert alert-warning">@fejlbesked</div>
    }
    else if (aktivElevplan != null)
    {
        <div class="card bg-light shadow-sm rounded mb-4">
            <div class="card-body">
                <h5 class="card-title">📋 Din elevplan</h5>
                <p><strong>Startdato:</strong> @aktivElevplan.StartDato.ToShortDateString()</p>
                <p><strong>Slutdato:</strong> @aktivElevplan.SlutDato.ToShortDateString()</p>
                <p><strong>Kommentar:</strong> @aktivElevplan.Kommentar</p>

                <button class="btn btn-outline-primary mt-3" @onclick="() => GåTilDelmål(aktivElevplan.Id)">
                    Se delmål og progression
                </button>
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-info">Ingen elevplan fundet endnu.</div>
    }

    <br />
    <h4 class="fw-semibold mb-3 border-bottom pb-2">📊 Dit elevdashboard</h4>

    <div class="row g-4 mb-4">
        <!-- Point & Niveau -->
        <div class="col-md-6">
            <div class="card border-0 shadow rounded-4 overflow-hidden">
                <div class="card-header bg-success text-white">
                    🔥 Point & Niveau
                </div>
                <div class="card-body">
                    <p>Du har <strong>450 XP</strong></p>
                    <p>Nuværende niveau: <strong>Tomat 🍳</strong></p>
                </div>
            </div>
        </div>

        <!-- ComwellConnect -->
        <div class="col-md-6">
            <div class="card border-0 shadow rounded-4 overflow-hidden">
                <div class="card-header bg-primary text-white">
                    🗨️ ComwellConnect
                </div>
                <div class="card-body text-center">
                    <p class="mb-3 text-muted">
                        Deltag i samtaler med andre elever, grupper og undervisere via intern chat.
                    </p>
                </div>
            </div>
        </div>

        <!-- Cooking GIF -->
        <div class="row g-4 mb-4">
            <div class="col-md-6">
                <div class="gif-item">
                    <img src="/sample-data/CookingGif.gif" class="gif-img" alt="Cooking GIF" />
                </div>
            </div>
            <div class="col-md-6">
                <div class="gif-item">
                    <img src="/sample-data/SanjicookingGif.gif" class="gif-img" alt="Sanji Cooking GIF" />
                </div>
            </div>
        </div>
    </div>
}

@code {
    private Modeller.Elevplan? aktivElevplan;
    private string? fejlbesked;
    private bool elevplanLoading = true;

    protected override async Task OnInitializedAsync()
    {
        if (UserState.IsLoggedIn && UserState.Id.HasValue)
        {
            try
            {
                aktivElevplan = await ElevplanService.GetElevplanByIdAsync(UserState.Id.Value);
            }
            catch (Exception ex)
            {
                fejlbesked = "Fejl under hentning af elevplan: " + ex.Message;
            }
        }

        elevplanLoading = false;
    }

    private void GåTilDelmål(int elevplanId)
    {
        NavManager.NavigateTo($"/delmaal/{elevplanId}");
    }
}
