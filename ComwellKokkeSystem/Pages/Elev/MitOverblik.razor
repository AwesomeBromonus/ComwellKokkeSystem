@page "/mitoverblik"
@inject NavigationManager NavManager
@inject IUserStateService UserStateService
@inject IElevplanService ElevplanService
@using ComwellKokkeSystem.Service
@using Modeller

<link href="css/Panel.css" rel="stylesheet" />

<div class="admin-container">
    <!-- Header -->
    <div class="admin-header">
        <h2>Velkommen, @UserStateService.CurrentUser?.Navn!</h2>
        <p>Din elevportal hos Comwell</p>
    </div>

    <!-- XP Progress -->
    <div class="xp-section">
        <div class="xp-progress-container">
            <div class="xp-progress-bar">
                <div class="xp-progress-fill" style="width: 48%"></div>
            </div>
            <div class="xp-text">
                <span class="xp-current">483</span>
                <span class="xp-total">/1000 XP</span>
            </div>
        </div>
        <div class="level-badge">
            <span class="level-name">Tomat</span>
            <span class="level-label">Nuværende niveau</span>
        </div>
    </div>

    <!-- Dashboard Cards -->
    <div class="dashboard-cards">
        <!-- Elevplan Card -->
        <div class="dashboard-card" @onclick="@(() => GoToSubGoals(currentElevplan?.Id ?? 0))">
            <div class="card-icon">📋</div>
            <div class="card-content">
                <h4>Din Elevplan</h4>
                @if (currentElevplan != null)
                {
                    <p class="card-dates">
                        @currentElevplan.StartDato.ToShortDateString() - @currentElevplan.SlutDato.ToShortDateString()
                    </p>
                }
                <span class="card-action">Se detaljer →</span>
            </div>
        </div>

        <!-- Læring Card -->
        <div class="dashboard-card" @onclick="GoToLearning">
            <div class="card-icon">📚</div>
            <div class="card-content">
                <h4>Læring</h4>
                <p>Udforsk materialer og forbedr dine færdigheder</p>
                <span class="card-action">Gå til læring →</span>
            </div>
        </div>

        <!-- Quiz Card -->
        <div class="dashboard-card" @onclick="GoToQuiz">
            <div class="card-icon">❓</div>
            <div class="card-content">
                <h4>Quizzer</h4>
                <p>Test din viden med sjove udfordringer</p>
                <span class="card-action">Tag en quiz →</span>
            </div>
        </div>
    </div>
</div>

@code {
    private Modeller.Elevplan? currentElevplan;

    protected override async Task OnInitializedAsync()
    {
        if (UserStateService.IsLoggedIn && UserStateService.CurrentUser?.Id != null)
        {
            var plans = await ElevplanService.GetElevplanerForElevAsync(UserStateService.CurrentUser.Id);
            currentElevplan = plans?.FirstOrDefault();
        }
    }

    private void GoToSubGoals(int elevplanId) => NavManager.NavigateTo($"/delmaal/{elevplanId}");
    private void GoToLearning() => NavManager.NavigateTo("/laering");
    private void GoToQuiz() => NavManager.NavigateTo("/quizlist");
}