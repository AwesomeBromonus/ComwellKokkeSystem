@page "/login"

@inject IAuthService AuthService
@inject NavigationManager NavManager
@inject UserState UserState
@using Modeller

<div class="flex items-center justify-center min-h-screen bg-gray-100">
    <div class="w-full max-w-md bg-white p-8 rounded-2xl shadow-xl">
        <h2 class="text-3xl font-bold text-center text-cyan-800 mb-6">Log ind</h2>

        <EditForm Model="@login" OnValidSubmit="@HandleLogin">
            <DataAnnotationsValidator />
            <ValidationSummary class="text-red-600 mb-4" />

            <div class="space-y-4">
                <label class="block">
                    <span class="text-sm font-medium text-gray-700">Brugernavn</span>
                    <InputText class="w-full mt-1 px-4 py-2 border border-gray-300 rounded-xl" @bind-Value="login.Username" />
                </label>

                <label class="block">
                    <span class="text-sm font-medium text-gray-700">Adgangskode</span>
                    <div class="relative">
                        <InputText class="w-full px-4 py-2 border border-gray-300 rounded-xl pr-16"
                                   type="@passwordInputType" @bind-Value="login.Password" />
                        <button type="button"
                                class="absolute top-1/2 right-3 transform -translate-y-1/2 text-sm text-cyan-700 hover:underline"
                                @onclick="TogglePasswordVisibility">
                            @(showPassword ? "Skjul" : "Vis")
                        </button>
                    </div>
                </label>
            </div>

            <button type="submit" class="mt-6 w-full py-3 bg-cyan-700 hover:bg-cyan-800 text-white font-semibold rounded-xl transition duration-300">
                Log ind
            </button>
        </EditForm>

        @if (!string.IsNullOrEmpty(message))
        {
            <div class="mt-4 text-center text-red-600 font-medium">@message</div>
        }

        <div class="text-center mt-4">
            <p class="text-sm">Har du ikke en bruger? <a href="/register" class="text-cyan-700 hover:underline">Opret her</a></p>
        </div>
    </div>
</div>

@code {
    private LoginModel login = new();
    private string message = "";
    private bool showPassword = false;

    private string passwordInputType => showPassword ? "text" : "password";

    private void TogglePasswordVisibility()
    {
        showPassword = !showPassword;
    }

    private async Task HandleLogin()
    {
        message = "";

        var success = await AuthService.Login(login);

        if (success)
        {
            if (UserState.Role?.ToLower() == "admin")
                NavManager.NavigateTo("/administrator");
            else
                NavManager.NavigateTo("/");
        }
        else
        {
            message = "Login fejlede.";
        }
    }
}
