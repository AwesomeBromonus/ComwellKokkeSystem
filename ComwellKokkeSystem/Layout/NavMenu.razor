@inject NavigationManager NavManager
@inject UserState UserState
@implements IDisposable

<div class="admin-sidebar d-flex flex-column justify-content-between">
    <!-- Logo -->
    <div>
        <div class="admin-logo text-center mb-4">
            <img src="/ComwellLogo2.png" alt="Comwell logo" />
        </div>

        <!-- Navigation -->
        <nav class="admin-nav">
            @if (!UserState.IsLoggedInChecked)
            {
                <span class="text-white">⏳ Indlæser menu...</span>
            }
            else if (UserState.Role?.ToLower() == "admin")
            {
                <NavLink class="nav-link" href="/administrator" Match="NavLinkMatch.All">🏠 Adminpanel</NavLink>
                <NavLink class="nav-link" href="/anmodninger">📬 Anmodninger</NavLink>
                <NavLink class="nav-link" href="/delmaalskabeloner">🧾 Delmålsskabeloner</NavLink>
                <NavLink class="nav-link" href="/rapportside">📊 Rapport</NavLink>
            }
            else if (UserState.Role?.ToLower() == "elev")
            {
                <NavLink class="nav-link" href="/mitoverblik" Match="NavLinkMatch.All">🗂️ Mit overblik</NavLink>
            }

            @if (UserState.IsLoggedIn)
            {
                <NavLink class="nav-link" href="/laering">📚 Læring</NavLink>
                <NavLink class="nav-link" href="/minprofil">🙍‍♂️ Min profil</NavLink>
            }
        </nav>
    </div>

    <!-- Footer med billede -->
    <div class="admin-footer text-center">
        @if (UserState.IsLoggedIn)
        {
            <img src="@($"/uploads/{UserState.Id}.jpg")"
                 alt="Profilbillede"
                 class="sidebar-profile-img mb-2" />

            <p class="text-white small mb-1">
                🔐 <strong>@UserState.Username</strong><br />
                <span class="text-white-50">(@UserState.Role)</span>
            </p>

            <button class="btn btn-outline-light btn-sm w-100 mt-1" @onclick="LogoutAsync">
                Log ud
            </button>
        }
    </div>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        UserState.OnChange += StateHasChanged;
        if (!UserState.IsLoggedInChecked)
        {
            await UserState.InitializeAsync();
        }
    }

    public void Dispose()
    {
        UserState.OnChange -= StateHasChanged;
    }

    private async Task LogoutAsync()
    {
        await UserState.LogoutAsync();
        NavManager.NavigateTo("/login", forceLoad: true);
    }
}
