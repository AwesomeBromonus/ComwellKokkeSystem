Index: Pages/Login.razor
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>@page \"/login\"\r\n\r\n@inject IAuthService AuthService\r\n@inject NavigationManager NavManager\r\n@inject UserState UserState\r\n@using Modeller\r\n\r\n<div class=\"d-flex justify-content-center align-items-center\" style=\"min-height: 100vh; background-color: #f5f5f5;\">\r\n    <div class=\"p-5 shadow\" style=\"background-color: white; border-radius: 20px; width: 100%; max-width: 480px;\">\r\n        <h2 class=\"text-center mb-4\" style=\"color: #003b4a;\">Log ind</h2>\r\n\r\n        <EditForm Model=\"@login\" OnValidSubmit=\"@HandleLogin\">\r\n            <DataAnnotationsValidator />\r\n            <ValidationSummary />\r\n\r\n            <div class=\"form-group mb-3\">\r\n                <label class=\"form-label\">Brugernavn</label>\r\n                <InputText class=\"form-control form-control-lg rounded-pill\" @bind-Value=\"login.Username\" />\r\n                <ValidationMessage For=\"@(() => login.Username)\" />\r\n            </div>\r\n\r\n            <div class=\"form-group mb-4\">\r\n                <label class=\"form-label\">Adgangskode</label>\r\n                <InputText type=\"password\" class=\"form-control form-control-lg rounded-pill\" @bind-Value=\"login.Password\" />\r\n                <ValidationMessage For=\"@(() => login.Password)\" />\r\n            </div>\r\n\r\n            <button type=\"submit\" class=\"btn btn-lg w-100 text-white\"\r\n                    style=\"background-color: #007fa3; border-radius: 50px;\" disabled=\"@isLoading\">\r\n                @(isLoading ? \"Logger ind...\" : \"Log ind\")\r\n            </button>\r\n        </EditForm>\r\n\r\n        @if (!string.IsNullOrEmpty(message))\r\n        {\r\n            <div class=\"alert alert-danger mt-3\">@message</div>\r\n        }\r\n\r\n        <div class=\"text-center mt-4 text-muted\" style=\"font-size: 0.95rem;\">\r\n            <p>❓ Har du problemer med at logge ind? Kontakt administrator eller HR-afdelingen.</p>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n@code {\r\n    private LoginModel login = new();\r\n    private string message = \"\";\r\n    private bool isLoading = false;\r\n\r\n    private async Task HandleLogin()\r\n    {\r\n        isLoading = true;\r\n        message = \"\";\r\n\r\n        try\r\n        {\r\n            var success = await AuthService.Login(login);\r\n            if (success)\r\n            {\r\n                var user = await AuthService.GetUserByUsername(login.Username);\r\n                if (user != null)\r\n                {\r\n                    await UserState.SetUserAsync(user.Username, user.Role, user.Id, user.HotelId, user.ElevplanId);\r\n\r\n                    if (user.Role?.ToLower() == \"admin\")\r\n                        NavManager.NavigateTo(\"/administrator\");\r\n                    else if (user.Role?.ToLower() == \"elev\")\r\n                        NavManager.NavigateTo(\"/mitoverblik\");\r\n                    else\r\n                        NavManager.NavigateTo(\"/\");\r\n                }\r\n                else\r\n                {\r\n                    message = \"Kunne ikke hente brugerdata.\";\r\n                }\r\n            }\r\n            else\r\n            {\r\n                message = \"Forkert brugernavn eller adgangskode.\";\r\n            }\r\n        }\r\n        catch (Exception ex)\r\n        {\r\n            message = $\"Login-fejl: {ex.Message}\";\r\n        }\r\n\r\n        isLoading = false;\r\n    }\r\n}\r\n
===================================================================
diff --git a/Pages/Login.razor b/Pages/Login.razor
--- a/Pages/Login.razor	(revision 5627cb947296b0abb5764d31d0e0c42114e45180)
+++ b/Pages/Login.razor	(date 1747205877854)
@@ -1,5 +1,4 @@
 @page "/login"
-
 @inject IAuthService AuthService
 @inject NavigationManager NavManager
 @inject UserState UserState
Index: Service/AuthService.cs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>using Modeller;\r\nusing System.Net.Http.Json;\r\n\r\npublic class AuthService : IAuthService\r\n{\r\n    private readonly HttpClient _http;\r\n    private readonly UserState _userState;\r\n\r\n    public AuthService(HttpClient http, UserState userState)\r\n    {\r\n        _http = http;\r\n        _userState = userState;\r\n    }\r\n\r\n    public async Task<bool> Login(LoginModel login)\r\n    {\r\n        var response = await _http.PostAsJsonAsync(\"api/users/login\", login);\r\n\r\n        if (response.IsSuccessStatusCode)\r\n        {\r\n            var result = await response.Content.ReadFromJsonAsync<LoginResponse>();\r\n\r\n            if (result != null)\r\n            {\r\n                // Fallback hvis HotelId eller ElevplanId mangler\r\n                int? hotelId = result.HotelId.HasValue ? result.HotelId : null;\r\n                int? elevplanId = result.ElevplanId.HasValue ? result.ElevplanId : null;\r\n\r\n                await _userState.SetUserAsync(result.Username, result.Role, result.Id, hotelId, elevplanId);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public async Task<UserModel?> GetUserByUsername(string username)\r\n    {\r\n        return await _http.GetFromJsonAsync<UserModel>($\"api/users/{username}\");\r\n    }\r\n\r\n    public async Task<bool> Register(UserModel user)\r\n    {\r\n        var response = await _http.PostAsJsonAsync(\"api/users/register\", user);\r\n        return response.IsSuccessStatusCode;\r\n    }\r\n\r\n    public Task<int?> GetCurrentUserIdAsync() => Task.FromResult(_userState.Id);\r\n    public Task<string?> GetCurrentUserRoleAsync() => Task.FromResult(_userState.Role);\r\n\r\n    public async Task Logout()\r\n    {\r\n        await _userState.LogoutAsync();\r\n    }\r\n}\r\n
===================================================================
diff --git a/Service/AuthService.cs b/Service/AuthService.cs
--- a/Service/AuthService.cs	(revision 5627cb947296b0abb5764d31d0e0c42114e45180)
+++ b/Service/AuthService.cs	(date 1747212250189)
@@ -1,5 +1,6 @@
 using Modeller;
 using System.Net.Http.Json;
+using Blazored.LocalStorage;
 
 public class AuthService : IAuthService
 {
Index: Pages/MitOverblik.razor
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>@page \"/mitoverblik\"\r\n@inject NavigationManager NavManager\r\n@inject UserState UserState\r\n@inject HttpClient Http\r\n\r\n<h3 class=\"mb-4\">\uD83C\uDF93 Mit Elev Overblik</h3>\r\n\r\n@if (!UserState.IsLoggedInChecked)\r\n{\r\n    <p>⏳ Indlæser brugerstatus...</p>\r\n}\r\nelse if (!UserState.IsLoggedIn)\r\n{\r\n    <div class=\"alert alert-warning\">\uD83D\uDD12 Du skal være logget ind for at se denne side.</div>\r\n}\r\nelse if (UserState.Role?.ToLower() != \"elev\")\r\n{\r\n    <div class=\"alert alert-danger\">\uD83D\uDEAB Adgang nægtet – kun elever har adgang til denne side.</div>\r\n}\r\nelse\r\n{\r\n    <div class=\"card shadow-sm border-0 mb-4 bg-light p-4 rounded-4\">\r\n        <h5 class=\"fw-bold\">Velkommen til Comwells elev system, @UserState.Username!</h5>\r\n       \r\n    </div>\r\n\r\n    @if (elevplanLoading)\r\n    {\r\n        <p>⏳ Indlæser elevplan...</p>\r\n    }\r\n    else if (!string.IsNullOrWhiteSpace(fejlbesked))\r\n    {\r\n        <div class=\"alert alert-warning\">@fejlbesked</div>\r\n    }\r\n    else if (aktivElevplan != null)\r\n    {\r\n        <div class=\"card bg-light shadow-sm rounded mb-4\">\r\n            <div class=\"card-body\">\r\n                <h5 class=\"card-title\">\uD83D\uDCCB Din elevplan</h5>\r\n                <p><strong>Startdato:</strong> @aktivElevplan.StartDato.ToShortDateString()</p>\r\n                <p><strong>Slutdato:</strong> @aktivElevplan.SlutDato.ToShortDateString()</p>\r\n                <p><strong>Kommentar:</strong> @aktivElevplan.Kommentar</p>\r\n\r\n                <button class=\"btn btn-outline-primary mt-3\" @onclick=\"() => GåTilDelmål(aktivElevplan.Id)\">\r\n                    Se delmål og progression\r\n                </button>\r\n            </div>\r\n        </div>\r\n    }\r\n    else\r\n    {\r\n        <div class=\"alert alert-info\">Ingen elevplan fundet endnu.</div>\r\n    }\r\n\r\n    <div class=\"row g-4 mb-4\">\r\n        <div class=\"col-md-6\">\r\n            <div class=\"card border-success shadow rounded-4\">\r\n                <div class=\"card-header bg-success text-white rounded-top-4\">\r\n                    \uD83D\uDD25 Point & Niveau\r\n                </div>\r\n                <div class=\"card-body\">\r\n                    <p>Du har <strong>450 XP</strong></p>\r\n                    <p>Nuværende niveau: <strong>Tomat \uD83C\uDF73</strong></p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"col-md-6\">\r\n            <div class=\"card border-primary shadow rounded-4\">\r\n                <div class=\"card-header bg-primary text-white rounded-top-4\">\r\n                    \uD83D\uDDE8\uFE0F ComwellConnect\r\n                </div>\r\n                <div class=\"card-body text-center\">\r\n                    <p class=\"mb-3 text-muted\">\r\n                        Deltag i samtaler med andre elever, grupper og undervisere via intern chat.\r\n                    </p>\r\n                    <a href=\"/messages\" class=\"btn btn-primary btn-lg shadow rounded-pill px-4\">\r\n                        Åbn ComwellConnect\r\n                    </a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n}\r\n\r\n@code {\r\n    private Elevplan? aktivElevplan;\r\n    private string? fejlbesked;\r\n    private bool elevplanLoading = true;\r\n\r\n    protected override async Task OnInitializedAsync()\r\n    {\r\n        if (UserState.IsLoggedIn && UserState.Id.HasValue)\r\n        {\r\n            try\r\n            {\r\n                aktivElevplan = await Http.GetFromJsonAsync<Elevplan>($\"api/elevplan/byuser/{UserState.Id.Value}\");\r\n            }\r\n            catch (Exception ex)\r\n            {\r\n                fejlbesked = \"Fejl under hentning af elevplan: \" + ex.Message;\r\n            }\r\n        }\r\n        elevplanLoading = false;\r\n    }\r\n\r\n    private void GåTilDelmål(int elevplanId)\r\n    {\r\n        NavManager.NavigateTo($\"/delmaal/{elevplanId}\");\r\n    }\r\n\r\n    public class Elevplan\r\n    {\r\n        public int Id { get; set; }\r\n        public DateTime OprettetDato { get; set; }\r\n        public string Kommentar { get; set; } = \"\";\r\n        public DateTime StartDato { get; set; }\r\n        public DateTime SlutDato { get; set; }\r\n        public int ElevId { get; set; }\r\n        public List<int> PraktikperiodeIds { get; set; } = new();\r\n    }\r\n}\r\n
===================================================================
diff --git a/Pages/MitOverblik.razor b/Pages/MitOverblik.razor
--- a/Pages/MitOverblik.razor	(revision 5627cb947296b0abb5764d31d0e0c42114e45180)
+++ b/Pages/MitOverblik.razor	(date 1747205877879)
@@ -1,4 +1,4 @@
-@page "/mitoverblik"
+ @page "/mitoverblik"
 @inject NavigationManager NavManager
 @inject UserState UserState
 @inject HttpClient Http
